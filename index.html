<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>链接防Q群管家撤回</title>
    <meta name="keywords" content="q群管家,qqunguanjia,link-anti-qqgj,qqgj,bddjr,半岛的蒟蒻,bandaodejuruo">
    <meta name="description" content="还在为Q群管家会撤回链接而感到烦恼？快试试这款工具吧！">
    <link rel="icon" href="/icon.webp">
    <style>
        *{
            font-family: system-ui;
            color-scheme: light dark;
        }
        #divmain {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            margin: auto;
            max-width: 800px;
        }
        #divmain2 {
            margin: 0 10px;
        }
        .example_link {
            color:#006afe;
        }
        #inputlink {
            font-size: 16px;
            --p: 0px;
            width: calc(100% - var(--p));
            /*width: 100%;*/
            margin: 0;
        }
        #outputlink {
            font-size: 16px;
            height: 140px;
            --p: 0px;
            width: calc(100% - var(--p));
            /*width: 100%;*/
            margin: 0;
            resize: vertical;
        }
        .h1img {
            height: 34px;
            margin: 6px 0 -6px;
            border-radius: 100%;
        }
        footer > p{
            margin: 4px 0;
        }
        @media (prefers-color-scheme: dark){
            .example_link{
                color:#64a4ff;
            }
        }
    </style>
</head>

<body>
    <div id="divmain"><div id="divmain2">
        <h1><img class="h1img" src="/icon.webp" alt=""/> 链接防Q群管家撤回</h1>
        <p>还在为Q群管家会撤回链接而感到烦恼？快试试这款工具吧！</p>
        <noscript><h1 style="color:red;">请允许运行JavaScript以使用本工具。</h1></noscript>
        <p style="margin-bottom: 4px;">输入正常的链接：</p>
        <input type="text" id="inputlink" />
        <p style="margin-bottom: 4px;">生成防撤回链接：</p>
        <textarea type="text" id="outputlink" readonly autocomplete="off"></textarea>
        <p>链接复制后粘贴到浏览器即可正常访问。</p>
        <hr />
        <p style="text-align: left;">
            绕过方案：<br />
            <br />
            1、将域名或ip的 . 替换为 。<br />
            <span class="example_link">baidu。com/s?wd=baidu</span><br />
            <br />
            2、如果需要带协议头，将协议头的双斜杠改为单斜杠<br />
            <span class="example_link">https:/baidu。com/s?wd=baidu</span><br />
            <br />
            3、遇到路径可能被识别为地址的情况，将路径的 . 前面或后面换行<br />
            <span class="example_link">https:/baidu。com/s?wd=127.0.0<br />
                .1</span><br />
            或者<br />
            <span class="example_link">https:/baidu。com/s?wd=127.0.0.<br />
                1</span><br />
            <br />
            4、需要发送带有IPv6的链接时，将半角 : 替换成全角 ：<br />
            <span class="example_link">[：：1]</span><br />
        </p>
        <hr />
        <footer>
            <p>源码仓库：<a href="https://github.com/bddjr/link-anti-qqgj" target="_blank" rel="noopener">link-anti-qqgj</a></p>
            <p>Made by <a href="https://bddjr.cn" target="_blank" rel="noopener">bddjr</a></p>
        </footer>
    </div></div>
    <script>
        inputlink.value = location.href;
        inputlink.addEventListener('input', (function () {
            //console.log('outputlink input');
            try {
                outputlink.value = '';
                inputvalue = inputlink.value;
                if (!inputvalue.includes('://')){
                    if (inputvalue.includes(':/')){
                        inputvalue = inputvalue.replace(':/', '://');
                    }else{
                        inputvalue = 'http://' + inputvalue;
                    }
                }
                url = new URL(inputvalue);
                outurl = {
                    hostname: url.hostname.replace(/\./g , '。').replace(/:/g , '：') ,
                    path: url.href.slice(url.origin.length).replace(/\./g , '\n.') ,
                    href: '',
                }
                if (inputlink.value.includes(':/')){
                    outurl.href = url.protocol + '/';
                }
                outurl.href += outurl.hostname;
                if (url.port){
                    outurl.href += ':' + url.port;
                }
                outurl.href += outurl.path;
                outputlink.value = outurl.href;
            }catch(e){
                console.error(e);
                outputlink.value = '生成失败';
            }
        }));
        inputlink.dispatchEvent(new Event('input'));
        outputlink.addEventListener('focus', function(){
            //console.log('outputlink click');
            if (!outputlink.activeElement){
                outputlink.select();
            }
        });
        inputlink.style.setProperty('--p', (inputlink.offsetWidth - divmain2.clientWidth)+'px');
        outputlink.style.setProperty('--p', (outputlink.offsetWidth - divmain2.clientWidth)+'px');
        dispatchEvent(new Event('resize'));
        console.log('js done');
    </script>
</body>

</html>
